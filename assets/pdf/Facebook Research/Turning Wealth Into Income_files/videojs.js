/*! @name @brightcove/videojs-ima3 @version 3.6.0 @license UNLICENSED */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("video.js"),require("global/window"),require("global/document")):"function"==typeof define&&define.amd?define(["video.js","global/window","global/document"],t):t((e=e||self).videojs,e.window,e.document)}(this,(function(e,t,n){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var a=function(e,t){t.isImmediatePropagationStopped=function(){return!0},t.cancelBubble=!0,t.isPropagationStopped=function(){return!0}},r=function(e,t,n){a(0,n),e.trigger({type:t+n.type,originalEvent:n})};function o(e){"playing"===e.type?function(e,t){e.ads.isInAdMode()&&(e.ads.isContentResuming()?e.ads._contentEnding&&r(e,"content",t):r(e,"ad",t))}(this,e):"ended"===e.type?function(e,t){e.ads.isInAdMode()?e.ads.isContentResuming()?(a(0,t),e.trigger("resumeended")):r(e,"ad",t):e.ads._contentHasEnded||e.ads.stitchedAds()||(r(e,"content",t),e.trigger("readyforpostroll"))}(this,e):"loadstart"===e.type||"loadeddata"===e.type||"loadedmetadata"===e.type?function(e,t){if(!("loadstart"===t.type&&!e.ads._hasThereBeenALoadStartDuringPlayerLife||"loadeddata"===t.type&&!e.ads._hasThereBeenALoadedData||"loadedmetadata"===t.type&&!e.ads._hasThereBeenALoadedMetaData))if(e.ads.inAdBreak())r(e,"ad",t);else{if(e.currentSrc()!==e.ads.contentSrc)return;r(e,"content",t)}}(this,e):"play"===e.type?function(e,t){e.ads.inAdBreak()?r(e,"ad",t):e.ads.isContentResuming()&&r(e,"content",t)}(this,e):this.ads.isInAdMode()&&(this.ads.isContentResuming()?r(this,"content",e):r(this,"ad",e))}var i=function(e,t){return t?encodeURIComponent(e):e},d=function(e,t,n){if(e&&e[n])for(var a=e[n],r=Object.keys(a),o=0;o<r.length;o++){t["{mediainfo."+n+"."+r[o]+"}"]=a[r[o]]}};function s(a,r,o){var s=this,A={};a=a.replace(/{([^}=]+)=([^}]+)}/g,(function(e,t,n){return A["{"+t+"}"]=n,"{"+t+"}"})),void 0===r&&(r=!1);var u={};for(var l in void 0!==o&&(u=o),u["{player.id}"]=this.options_["data-player"],u["{player.height}"]=this.currentHeight(),u["{player.width}"]=this.currentWidth(),u["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",u["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",u["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",u["{player.duration}"]=this.duration(),u["{player.pageUrl}"]=e.dom.isInFrame()?n.referrer:t.location.href,u["{playlistinfo.id}"]=this.playlistinfo?this.playlistinfo.id:"",u["{playlistinfo.name}"]=this.playlistinfo?this.playlistinfo.name:"",u["{timestamp}"]=(new Date).getTime(),u["{document.referrer}"]=n.referrer,u["{window.location.href}"]=t.location.href,u["{random}"]=Math.floor(1e12*Math.random()),["description","tags","reference_id","ad_keys"].forEach((function(e){s.mediainfo&&s.mediainfo[e]?u["{mediainfo."+e+"}"]=s.mediainfo[e]:A["{mediainfo."+e+"}"]?u["{mediainfo."+e+"}"]=A["{mediainfo."+e+"}"]:u["{mediainfo."+e+"}"]=""})),d(this.mediainfo,u,"custom_fields"),d(this.mediainfo,u,"customFields"),u)a=a.split(l).join(i(u[l],r));for(var c in a=a.replace(/{pageVariable\.([^}]+)}/g,(function(n,a){for(var o,d=t,s=a.split("."),u=0;u<s.length;u++)u===s.length-1?o=d[s[u]]:d=d[s[u]];var l=typeof o;return null===o?"null":void 0===o?A["{pageVariable."+a+"}"]?A["{pageVariable."+a+"}"]:(e.log.warn('Page variable "'+a+'" not found'),""):"string"!==l&&"number"!==l&&"boolean"!==l?(e.log.warn('Page variable "'+a+'" is not a supported type'),""):i(String(o),r)})),A)a=a.replace(c,A[c]);return a}var A={processMetadataTracks:function(e,t){for(var n=e.textTracks(),a=function(n){"metadata"===n.kind&&(e.ads.cueTextTracks.setMetadataTrackMode(n),t(e,n))},r=0;r<n.length;r++)a(n[r]);n.addEventListener("addtrack",(function(e){a(e.track)}))},setMetadataTrackMode:function(e){},getSupportedAdCue:function(e,t){return t},isSupportedAdCue:function(e,t){return!0},getCueId:function(e,t){return t.id}},u=function(e,t){return void 0!==t&&e.ads.includedCues[t]},l=function(e,t){void 0!==t&&""!==t&&(e.ads.includedCues[t]=!0)};function c(){!1!==this.ads._shouldBlockPlay&&(this.paused()||(this.ads.debug("Playback was canceled by cancelContentPlay"),this.pause()),this.ads._cancelledPlay=!0)}A.processAdTrack=function(t,n,a,r){t.ads.includedCues={};for(var o=0;o<n.length;o++){var i=n[o],d=this.getSupportedAdCue(t,i);if(!this.isSupportedAdCue(t,i))return void e.log.warn("Skipping as this is not a supported ad cue.",i);var s=this.getCueId(t,i),A=i.startTime;if(u(t,s))return void e.log("Skipping ad already seen with ID "+s);r&&r(t,d,s,A),a(t,d,s,A),l(t,s)}};var m={},p=e;m.isMiddlewareMediatorSupported=function(){return!p.browser.IS_IOS&&!p.browser.IS_ANDROID&&!!(p.use&&p.middleware&&p.middleware.TERMINATOR)},m.playMiddleware=function(t){return{setSource:function(e,t){t(null,e)},callPlay:function(){if(t.ads&&!0===t.ads._shouldBlockPlay)return t.ads.debug("Using playMiddleware to block content playback"),t.ads._playBlocked=!0,p.middleware.TERMINATOR},play:function(n,a){t.ads&&t.ads._playBlocked&&n?(t.ads.debug("Play call to Tech was terminated."),t.trigger("play"),t.addClass("vjs-has-started"),t.ads._playBlocked=!1):a&&a.catch&&a.catch((function(n){"NotAllowedError"!==n.name||e.browser.IS_SAFARI||t.trigger("pause")}))}}},m.testHook=function(e){p=e};var g=m.playMiddleware,f=m.isMiddlewareMediatorSupported;var h=function(){function e(){}return e.getState=function(t){if(t)return e.states_&&e.states_[t]?e.states_[t]:void 0},e.registerState=function(t,n){if("string"!=typeof t||!t)throw new Error('Illegal state name, "'+t+'"; must be a non-empty string.');return e.states_||(e.states_={}),e.states_[t]=n,n},e}(),v=function(){function t(e){this.player=e}t._getName=function(){return"Anonymous State"};var n=t.prototype;return n.transitionTo=function(e){var t=this.player;this.cleanup(t);var n=new e(t);t.ads._state=n,t.ads.debug(this.constructor._getName()+" -> "+n.constructor._getName());for(var a=arguments.length,r=new Array(a>1?a-1:0),o=1;o<a;o++)r[o-1]=arguments[o];n.init.apply(n,[t].concat(r))},n.init=function(){},n.cleanup=function(){},n.onPlay=function(){},n.onPlaying=function(){},n.onEnded=function(){},n.onAdEnded=function(){},n.onAdsReady=function(){e.log.warn("Unexpected adsready event")},n.onAdsError=function(){},n.onAdsCanceled=function(){},n.onAdTimeout=function(){},n.onAdStarted=function(){},n.onContentChanged=function(){},n.onContentResumed=function(){},n.onReadyForPostroll=function(){e.log.warn("Unexpected readyforpostroll event")},n.onNoPreroll=function(){},n.onNoPostroll=function(){},n.startLinearAdMode=function(){e.log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},n.endLinearAdMode=function(){e.log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},n.skipLinearAdMode=function(){e.log.warn("Unexpected skipLinearAdMode invocation (State via "+this.constructor._getName()+")")},n.isAdState=function(){throw new Error("isAdState unimplemented for "+this.constructor._getName())},n.isWaitingForAdBreak=function(){return!1},n.isContentResuming=function(){return!1},n.inAdBreak=function(){return!1},n.handleEvent=function(e){var t=this.player;"play"===e?this.onPlay(t):"adsready"===e?this.onAdsReady(t):"adserror"===e?this.onAdsError(t):"adscanceled"===e?this.onAdsCanceled(t):"adtimeout"===e?this.onAdTimeout(t):"ads-ad-started"===e?this.onAdStarted(t):"contentchanged"===e?this.onContentChanged(t):"contentresumed"===e?this.onContentResumed(t):"readyforpostroll"===e?this.onReadyForPostroll(t):"playing"===e?this.onPlaying(t):"ended"===e?this.onEnded(t):"nopreroll"===e?this.onNoPreroll(t):"nopostroll"===e?this.onNoPostroll(t):"adended"===e&&this.onAdEnded(t)},t}();function y(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}h.registerState("State",v);var S=function(e){function t(t){var n;return(n=e.call(this,t)||this).contentResuming=!1,n.waitingForAdBreak=!1,n}y(t,e);var n=t.prototype;return n.isAdState=function(){return!0},n.onPlaying=function(){var e=h.getState("ContentPlayback");this.contentResuming&&this.transitionTo(e)},n.onContentResumed=function(){var e=h.getState("ContentPlayback");this.contentResuming&&this.transitionTo(e)},n.isWaitingForAdBreak=function(){return this.waitingForAdBreak},n.isContentResuming=function(){return this.contentResuming},n.inAdBreak=function(){return!0===this.player.ads._inLinearAdMode},t}(v);h.registerState("AdState",S);var C=function(e){function t(){return e.apply(this,arguments)||this}y(t,e);var n=t.prototype;return n.isAdState=function(){return!1},n.onContentChanged=function(e){var t=h.getState("BeforePreroll"),n=h.getState("Preroll");e.ads.debug("Received contentchanged event (ContentState)"),e.paused()?this.transitionTo(t):(this.transitionTo(n,!1),e.pause(),e.ads._pausedOnContentupdate=!0)},t}(v);h.registerState("ContentState",C);var _,P=function(t){function n(){return t.apply(this,arguments)||this}y(n,t),n._getName=function(){return"AdsDone"};var a=n.prototype;return a.init=function(e){e.ads._contentHasEnded=!0,e.trigger("ended")},a.startLinearAdMode=function(){e.log.warn("Unexpected startLinearAdMode invocation (AdsDone)")},n}(h.getState("ContentState"));h.registerState("AdsDone",P);var M={start:function(t){t.ads.debug("Starting ad break"),t.ads._inLinearAdMode=!0,t.trigger("adstart"),t.ads.shouldTakeSnapshots()&&(t.ads.snapshot=function(t){var n;n=e.browser.IS_IOS&&t.ads.isLive(t)&&t.seekable().length>0?t.currentTime()-t.seekable().end(0):t.currentTime();var a=t.$(".vjs-tech"),r=t.textTracks?t.textTracks():[],o=[],i={ended:t.ended(),currentSrc:t.currentSrc(),sources:t.currentSources(),src:t.tech_.src(),currentTime:n,type:t.currentType()};a&&(i.style=a.getAttribute("style"));for(var d=0;d<r.length;d++){var s=r[d];o.push({track:s,mode:s.mode}),s.mode="disabled"}return i.suppressedTracks=o,i}(t)),t.ads.shouldPlayContentBehindAd(t)&&(t.ads.preAdVolume_=t.volume(),t.volume(0)),t.addClass("vjs-ad-playing"),t.hasClass("vjs-live")&&t.removeClass("vjs-live"),t.ads.removeNativePoster()},end:function(t,n){t.ads.debug("Ending ad break"),void 0===n&&(n=function(){}),t.ads.adType=null,t.ads._inLinearAdMode=!1,t.trigger("adend"),t.removeClass("vjs-ad-playing"),t.ads.isLive(t)&&t.addClass("vjs-live"),t.ads.shouldTakeSnapshots()?function(t,n){var a=t.ads.snapshot;if(void 0===n&&(n=function(){}),!0===t.ads.disableNextSnapshotRestore)return t.ads.disableNextSnapshotRestore=!1,delete t.ads.snapshot,void n();var r,o=t.$(".vjs-tech"),i=20,d=a.suppressedTracks,s=function(){for(var e=0;e<d.length;e++)(r=d[e]).track.mode=r.mode},A=function(){var n;if(e.browser.IS_IOS&&t.ads.isLive(t)){if(a.currentTime<0&&(n=t.seekable().length>0?t.seekable().end(0)+a.currentTime:t.currentTime(),t.currentTime(n)),t.paused()){var r=t.play();r&&r.catch&&r.catch((function(t){e.log.warn("Play promise rejected in IOS snapshot resume",t)}))}}else if(a.ended)t.currentTime(t.duration());else{t.currentTime(a.currentTime);var o=t.play();o&&o.catch&&o.catch((function(t){e.log.warn("Play promise rejected in snapshot resume",t)}))}t.ads.shouldRemoveAutoplay_&&(t.autoplay(!1),t.ads.shouldRemoveAutoplay_=!1)},u=function n(){if(t.off("contentcanplay",n),_&&t.clearTimeout(_),(o=t.el().querySelector(".vjs-tech")).readyState>1)return A();if(void 0===o.seekable)return A();if(o.seekable.length>0)return A();if(i--)t.setTimeout(n,50);else try{A()}catch(t){e.log.warn("Failed to resume the content after an advertisement",t)}};if("style"in a&&o.setAttribute("style",a.style||""),t.ads.videoElementRecycled())t.one("resumeended",(function(){delete t.ads.snapshot,n()})),t.one("contentloadedmetadata",s),e.browser.IS_IOS&&!t.autoplay()&&(t.autoplay(!0),t.ads.shouldRemoveAutoplay_=!0),t.src(a.sources),t.one("contentcanplay",u),_=t.setTimeout(u,2e3);else{if(s(),!t.ended()){var l=t.play();l&&l.catch&&l.catch((function(t){e.log.warn("Play promise rejected in snapshot restore",t)}))}delete t.ads.snapshot,n()}}(t,n):(t.volume(t.ads.preAdVolume_),n())}},b=function(t){function n(){return t.apply(this,arguments)||this}y(n,t),n._getName=function(){return"Preroll"};var a=n.prototype;return a.init=function(e,t,n){if(this.waitingForAdBreak=!0,e.addClass("vjs-ad-loading"),n||e.ads.nopreroll_)return this.resumeAfterNoPreroll(e);var a=e.ads.settings.timeout;"number"==typeof e.ads.settings.prerollTimeout&&(a=e.ads.settings.prerollTimeout),this._timeout=e.setTimeout((function(){e.trigger("adtimeout")}),a),t?this.handleAdsReady():this.adsReady=!1},a.onAdsReady=function(t){t.ads.inAdBreak()?e.log.warn("Unexpected adsready event (Preroll)"):(t.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},a.handleAdsReady=function(){this.adsReady=!0,this.readyForPreroll()},a.afterLoadStart=function(e){var t=this.player;t.ads._hasThereBeenALoadStartDuringPlayerLife?e():(t.ads.debug("Waiting for loadstart..."),t.one("loadstart",(function(){t.ads.debug("Received loadstart event"),e()})))},a.noPreroll=function(){var e=this;this.afterLoadStart((function(){e.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)"),e.resumeAfterNoPreroll(e.player)}))},a.readyForPreroll=function(){var e=this.player;this.afterLoadStart((function(){e.ads.debug("Triggered readyforpreroll event (Preroll)"),e.trigger("readyforpreroll")}))},a.onAdsCanceled=function(e){var t=this;e.ads.debug("adscanceled (Preroll)"),this.afterLoadStart((function(){t.resumeAfterNoPreroll(e)}))},a.onAdsError=function(t){var n=this;e.log("adserror (Preroll)"),this.inAdBreak()?t.ads.endLinearAdMode():this.afterLoadStart((function(){n.resumeAfterNoPreroll(t)}))},a.startLinearAdMode=function(){var t=this.player;!this.adsReady||t.ads.inAdBreak()||this.isContentResuming()?e.log.warn("Unexpected startLinearAdMode invocation (Preroll)"):(this.clearTimeout(t),t.ads.adType="preroll",this.waitingForAdBreak=!1,M.start(t),t.ads._shouldBlockPlay=!1)},a.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},a.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(e.removeClass("vjs-ad-loading"),e.addClass("vjs-ad-content-resuming"),this.contentResuming=!0,M.end(e))},a.skipLinearAdMode=function(){var t=this,n=this.player;n.ads.inAdBreak()||this.isContentResuming()?e.log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart((function(){n.trigger("adskip"),n.ads.debug("skipLinearAdMode (Preroll)"),t.resumeAfterNoPreroll(n)}))},a.onAdTimeout=function(e){var t=this;this.afterLoadStart((function(){e.ads.debug("adtimeout (Preroll)"),t.resumeAfterNoPreroll(e)}))},a.onNoPreroll=function(t){t.ads.inAdBreak()||this.isContentResuming()?e.log.warn("Unexpected nopreroll event (Preroll)"):this.noPreroll()},a.resumeAfterNoPreroll=function(e){if(this.contentResuming=!0,e.ads._shouldBlockPlay=!1,this.cleanupPartial(e),e.paused()&&(e.ads._playRequested||e.ads._pausedOnContentupdate)){var t=e.play();t&&t.then&&t.then(null,(function(e){}))}},a.cleanup=function(t){t.ads._hasThereBeenALoadStartDuringPlayerLife||e.log.warn("Leaving Preroll state before loadstart event can cause issues."),this.cleanupPartial(t)},a.cleanupPartial=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming"),this.clearTimeout(e)},a.clearTimeout=function(e){e.clearTimeout(this._timeout),this._timeout=null},n}(h.getState("AdState"));h.registerState("Preroll",b);var T=function(e){function t(){return e.apply(this,arguments)||this}y(t,e),t._getName=function(){return"BeforePreroll"};var n=t.prototype;return n.init=function(e){this.adsReady=!1,this.shouldResumeToContent=!1,e.ads._shouldBlockPlay=!0},n.onAdsReady=function(e){e.ads.debug("Received adsready event (BeforePreroll)"),this.adsReady=!0},n.onPlay=function(e){var t=h.getState("Preroll");e.ads.debug("Received play event (BeforePreroll)"),this.transitionTo(t,this.adsReady,this.shouldResumeToContent)},n.onAdsCanceled=function(e){e.ads.debug("adscanceled (BeforePreroll)"),this.shouldResumeToContent=!0},n.onAdsError=function(){this.player.ads.debug("adserror (BeforePreroll)"),this.shouldResumeToContent=!0},n.onNoPreroll=function(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)"),this.shouldResumeToContent=!0},n.skipLinearAdMode=function(){var e=this.player;e.trigger("adskip"),e.ads.debug("skipLinearAdMode (BeforePreroll)"),this.shouldResumeToContent=!0},n.onContentChanged=function(){this.init(this.player)},t}(h.getState("ContentState"));h.registerState("BeforePreroll",T);var k=function(e){function t(){return e.apply(this,arguments)||this}y(t,e),t._getName=function(){return"Midroll"};var n=t.prototype;return n.init=function(e){e.ads.adType="midroll",M.start(e),e.addClass("vjs-ad-loading")},n.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},n.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(this.contentResuming=!0,e.addClass("vjs-ad-content-resuming"),e.removeClass("vjs-ad-loading"),M.end(e))},n.onAdsError=function(e){this.inAdBreak()&&e.ads.endLinearAdMode()},n.cleanup=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming")},t}(h.getState("AdState"));h.registerState("Midroll",k);var w=function(t){function n(){return t.apply(this,arguments)||this}y(n,t),n._getName=function(){return"Postroll"};var a=n.prototype;return a.init=function(e){if(this.waitingForAdBreak=!0,e.ads._contentEnding=!0,e.ads.nopostroll_){this.resumeContent(e);var t=h.getState("AdsDone");this.transitionTo(t)}else{e.addClass("vjs-ad-loading");var n=e.ads.settings.timeout;"number"==typeof e.ads.settings.postrollTimeout&&(n=e.ads.settings.postrollTimeout),this._postrollTimeout=e.setTimeout((function(){e.trigger("adtimeout")}),n)}},a.startLinearAdMode=function(){var t=this.player;t.ads.inAdBreak()||this.isContentResuming()?e.log.warn("Unexpected startLinearAdMode invocation (Postroll)"):(t.ads.adType="postroll",t.clearTimeout(this._postrollTimeout),this.waitingForAdBreak=!1,M.start(t))},a.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},a.endLinearAdMode=function(){var e=this,t=this.player,n=h.getState("AdsDone");this.inAdBreak()&&(t.removeClass("vjs-ad-loading"),this.resumeContent(t),M.end(t,(function(){e.transitionTo(n)})))},a.skipLinearAdMode=function(){var t=this.player;t.ads.inAdBreak()||this.isContentResuming()?e.log.warn("Unexpected skipLinearAdMode invocation"):(t.ads.debug("Postroll abort (skipLinearAdMode)"),t.trigger("adskip"),this.abort(t))},a.onAdTimeout=function(e){e.ads.debug("Postroll abort (adtimeout)"),this.abort(e)},a.onAdsError=function(e){e.ads.debug("Postroll abort (adserror)"),e.ads.inAdBreak()?e.ads.endLinearAdMode():this.abort(e)},a.onContentChanged=function(e){if(this.isContentResuming()){var t=h.getState("BeforePreroll");this.transitionTo(t)}else if(!this.inAdBreak()){var n=h.getState("Preroll");this.transitionTo(n)}},a.onNoPostroll=function(t){this.isContentResuming()||this.inAdBreak()?e.log.warn("Unexpected nopostroll event (Postroll)"):this.abort(t)},a.resumeContent=function(e){this.contentResuming=!0,e.addClass("vjs-ad-content-resuming")},a.abort=function(e){var t=h.getState("AdsDone");this.resumeContent(e),e.removeClass("vjs-ad-loading"),this.transitionTo(t)},a.cleanup=function(e){e.removeClass("vjs-ad-content-resuming"),e.clearTimeout(this._postrollTimeout),e.ads._contentEnding=!1},n}(h.getState("AdState"));h.registerState("Postroll",w);var R=function(e){function t(){return e.apply(this,arguments)||this}y(t,e),t._getName=function(){return"ContentPlayback"};var n=t.prototype;return n.init=function(e){e.ads._shouldBlockPlay=!1},n.onAdsReady=function(e){e.ads.debug("Received adsready event (ContentPlayback)"),e.ads.nopreroll_||(e.ads.debug("Triggered readyforpreroll event (ContentPlayback)"),e.trigger("readyforpreroll"))},n.onReadyForPostroll=function(e){var t=h.getState("Postroll");e.ads.debug("Received readyforpostroll event"),this.transitionTo(t)},n.startLinearAdMode=function(){var e=h.getState("Midroll");this.transitionTo(e)},t}(h.getState("ContentState"));h.registerState("ContentPlayback",R);var q=function(e){function t(){return e.apply(this,arguments)||this}y(t,e),t._getName=function(){return"StitchedContentPlayback"};var n=t.prototype;return n.init=function(){this.player.ads._shouldBlockPlay=!1},n.onContentChanged=function(){this.player.ads.debug("Received contentchanged event ("+this.constructor._getName()+")")},n.startLinearAdMode=function(){var e=h.getState("StitchedAdRoll");this.transitionTo(e)},t}(h.getState("ContentState"));h.registerState("StitchedContentPlayback",q);var E=function(e){function t(){return e.apply(this,arguments)||this}y(t,e),t._getName=function(){return"StitchedAdRoll"};var n=t.prototype;return n.init=function(){this.waitingForAdBreak=!1,this.contentResuming=!1,this.player.ads.adType="stitched",M.start(this.player)},n.onPlaying=function(){},n.onContentResumed=function(){},n.onAdEnded=function(){this.endLinearAdMode(),this.player.trigger("ended")},n.endLinearAdMode=function(){var e=h.getState("StitchedContentPlayback");M.end(this.player),this.transitionTo(e)},t}(h.getState("AdState"));h.registerState("StitchedAdRoll",E);var I=m.isMiddlewareMediatorSupported,B=e.getTech("Html5").Events,L={timeout:5e3,prerollTimeout:void 0,postrollTimeout:void 0,debug:!1,stitchedAds:!1,contentIsLive:void 0,liveCuePoints:!0},j=function(t){var n=this,a=e.mergeOptions(L,t),r=[];B.concat(["firstplay","loadedalldata"]).forEach((function(e){-1===r.indexOf(e)&&r.push(e)})),n.on(r,o),I()||function(t,n){n&&e.log("Using cancelContentPlay to block content playback"),t.on("play",c)}(n,a.debug),n.setTimeout((function(){n.ads._hasThereBeenALoadStartDuringPlayerLife||""===n.src()||e.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html")}),5e3),n.on("ended",(function(){n.hasClass("vjs-has-started")||n.addClass("vjs-has-started")})),n.on("contenttimeupdate",(function(){n.removeClass("vjs-waiting")})),n.on(["addurationchange","adcanplay"],(function(){if(!n.ads.settings.stitchedAds&&!n.hasStarted()&&(!n.ads.snapshot||n.currentSrc()!==n.ads.snapshot.currentSrc)&&n.ads.inAdBreak()){var t=n.play();t&&t.catch&&t.catch((function(t){e.log.warn("Play promise rejected when playing ad",t)}))}})),n.on("nopreroll",(function(){n.ads.debug("Received nopreroll event"),n.ads.nopreroll_=!0})),n.on("nopostroll",(function(){n.ads.debug("Received nopostroll event"),n.ads.nopostroll_=!0})),n.on("playing",(function(){n.ads._cancelledPlay=!1,n.ads._pausedOnContentupdate=!1})),n.on("play",(function(){n.ads._playRequested=!0})),n.one("loadstart",(function(){n.ads._hasThereBeenALoadStartDuringPlayerLife=!0})),n.on("loadeddata",(function(){n.ads._hasThereBeenALoadedData=!0})),n.on("loadedmetadata",(function(){n.ads._hasThereBeenALoadedMetaData=!0})),n.ads=function(t){return{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,adType:null,VERSION:"6.7.0",reset:function(){t.ads.disableNextSnapshotRestore=!1,t.ads._contentEnding=!1,t.ads._contentHasEnded=!1,t.ads.snapshot=null,t.ads.adType=null,t.ads._hasThereBeenALoadedData=!1,t.ads._hasThereBeenALoadedMetaData=!1,t.ads._cancelledPlay=!1,t.ads._shouldBlockPlay=!1,t.ads._playBlocked=!1,t.ads.nopreroll_=!1,t.ads.nopostroll_=!1,t.ads._playRequested=!1},startLinearAdMode:function(){t.ads._state.startLinearAdMode()},endLinearAdMode:function(){t.ads._state.endLinearAdMode()},skipLinearAdMode:function(){t.ads._state.skipLinearAdMode()},stitchedAds:function(t){return void 0!==t&&(e.log.warn("Using player.ads.stitchedAds() as a setter is deprecated, it should be set as an option upon initialization of contrib-ads."),this.settings.stitchedAds=!!t),this.settings.stitchedAds},videoElementRecycled:function(){if(t.ads.shouldPlayContentBehindAd(t))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var e=t.tech_.src()!==this.snapshot.src,n=t.currentSrc()!==this.snapshot.currentSrc;return e||n},isLive:function(n){return void 0===n&&(n=t),"boolean"==typeof n.ads.settings.contentIsLive?n.ads.settings.contentIsLive:n.duration()===1/0||"8"===e.browser.IOS_VERSION&&0===n.duration()},shouldPlayContentBehindAd:function(n){if(void 0===n&&(n=t),n)return!!n.ads.settings.liveCuePoints&&(!e.browser.IS_IOS&&!e.browser.IS_ANDROID&&n.duration()===1/0);throw new Error("shouldPlayContentBehindAd requires a player as a param")},shouldTakeSnapshots:function(e){return void 0===e&&(e=t),!this.shouldPlayContentBehindAd(e)&&!this.stitchedAds()},isInAdMode:function(){return this._state.isAdState()},isWaitingForAdBreak:function(){return this._state.isWaitingForAdBreak()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:function(){return this._state.inAdBreak()},removeNativePoster:function(){var e=t.$(".vjs-tech");e&&e.removeAttribute("poster")},debug:function(){if(this.settings.debug){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];1===n.length&&"string"==typeof n[0]?e.log("ADS: "+n[0]):e.log.apply(e,["ADS:"].concat(n))}}}}(n),n.ads.settings=a,a.stitchedAds=!!a.stitchedAds,a.stitchedAds?n.ads._state=new(h.getState("StitchedContentPlayback"))(n):n.ads._state=new(h.getState("BeforePreroll"))(n),n.ads._state.init(n),n.ads.cueTextTracks=A,n.ads.adMacroReplacement=s.bind(n),function(e){e.ads.contentSrc=e.currentSrc(),e.ads._seenInitialLoadstart=!1,e.on("loadstart",(function(){if(!e.ads.inAdBreak()){var t=e.currentSrc();t!==e.ads.contentSrc&&(e.ads._seenInitialLoadstart&&e.trigger({type:"contentchanged"}),e.trigger({type:"contentupdate",oldValue:e.ads.contentSrc,newValue:t}),e.ads.contentSrc=t),e.ads._seenInitialLoadstart=!0}}))}(n),n.on("contentchanged",n.ads.reset);var i=function(){var t=n.textTracks();if(!n.ads.shouldPlayContentBehindAd(n)&&n.ads.inAdBreak()&&n.tech_.featuresNativeTextTracks&&e.browser.IS_IOS&&!Array.isArray(n.textTracks()))for(var a=0;a<t.length;a++){var r=t[a];"showing"===r.mode&&(r.mode="disabled")}};n.ready((function(){n.textTracks().addEventListener("change",i)})),n.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"],(function(e){n.ads._state.handleEvent(e.type)})),n.on("dispose",(function(){n.ads.reset(),n.textTracks().removeEventListener("change",i)}))};j.VERSION="6.7.0",function(t){!function(){if(e.getPlugin)return Boolean(e.getPlugin("ads"));var t=e.getComponent("Player");return Boolean(t&&t.prototype.ads)}()&&((e.registerPlugin||e.plugin)("ads",t),f()&&!e.usingContribAdsMiddleware_&&(e.use("*",g),e.usingContribAdsMiddleware_=!0,e.log.debug("Play middleware has been registered with videojs")))}(j);var O;(e.registerPlugin||e.plugin)("contribAds6Shim",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this,a=void 0,r=void 0,o=0,i=!1;this.contribAds6Shim={VERSION:"1.0.1"},n.ads.state=a=r="content-set",Object.defineProperty(n.ads,"state",{get:function(){return(!0===t.warnOnGetState||"number"==typeof t.warnOnGetState&&o<t.warnOnGetState)&&(e.log.warn("player.ads.state is deprecated. Please use the public methods provided by videojs-contrib-ads 6 instead: https://github.com/videojs/videojs-contrib-ads#public-methods"),o++),t.stateUsageEvent&&!i&&(n.trigger({type:"usage",name:"contrib-ads-state-access"}),i=!0),r},set:function(n){n!==r&&(a=r,r=n,t.debug&&e.log("CA6Shim: "+a+" -> "+r))}}),n.on("contentchanged",(function(){n.paused()?n.ads.state="content-set":n.ads.state="ads-ready?"})),n.on("play",(function(){"content-set"===r?n.ads.state="ads-ready?":"ads-ready"===r&&(n.ads.state="preroll?")})),n.on("adsready",(function(){"content-set"===r?n.ads.state="ads-ready":"ads-ready?"===r&&(n.ads.state="preroll?")})),n.on(["adserror","adtimeout","adskip"],(function(){"ads-ready?"!==r&&"preroll?"!==r||(n.ads.state="content-playback")})),n.on("adstart",(function(){n.ads.state="ad-playback"})),n.on("adend",(function(){n.ads.state="content-resuming"})),n.on("playing",(function(){"content-playback"!==r&&(n.trigger("contentplayback"),t.debug&&e.log("CA6Shim: Triggered contentplayback")),n.ads.state="content-playback"})),n.on("contentended",(function(){"content-playback"===r&&(n.ads.state="postroll?")})),n.on("ended",(function(){n.ads.state="content-playback"}))}));var N=function(e,t){var n=t.cues,a=t.label,r=t.inBandMetadataTrackDispatchType,o=t.kind;if("metadata"===o)return"media-cues"===a||(!(!r||"metadata"!==o)||(!n||!n.length||e.ima3.cueState_.cueModule.isSupportedAdCue(e,n[0])))},U=function(t,n,a,r,o){0===r&&t.ima3.cueState_.prerollPlayed||o<=1&&t.ima3.cueState_.postrollPlayed||(!function(t,n,a){var r,o=Math.abs(a-t.duration()),i=Math.abs(a-t.currentTime());if(0===a){if(t.ima3.cueState_.prerollPlayed)return;t.ima3.cueState_.prerollPlayed=!0,t.ads.adType="preroll"}if(o<=1){if(t.ima3.cueState_.postrollPlayed)return;t.ima3.cueState_.postrollPlayed=!0}i>=1||(r=!t.ima3.settings.useMediaCuePoints&&n.serverUrl?n.serverUrl:t.ima3.settings.serverUrl,r=t.ima3.adMacroReplacement(r),n.duration&&(/\?/.test(r)?r+="&breaklength="+n.duration:r+="?breaklength="+n.duration),t.ima3.isReady_&&(e.log("Oncue ad request at "+a+" seconds"),t.ima3.adrequest(r)))}(t,n,r),t.ima3.cueState_.usedActiveCues[a]=!0)},D=function(e,t,n,a,r){0===a&&0===e.currentTime()&&(e.ima3.cueState_.prerollPlayed||e.ima3.cueState_.prerollHandledEarly||(e.paused()&&!e.ads._playRequested?(e.ima3.cueState_.prerollHandledEarly=!0,e.ima3.oneUnlessContentUpdate_("play",(function(){U(e,t,n,a,r)}))):e.ads.isInAdMode()&&!e.ads.isContentResuming()&&e.ads._playRequested&&U(e,t,n,a,r)))},x=function(e){return e.mediainfo?Math.max(e.duration(),e.mediainfo.duration):e.duration()},V=function(t,n,a,r){var o,i=x(t),d=Math.abs(r-i);t.ads.isAdPlaying()&&((o=n)&&o.text&&"ad"===o.text.toLowerCase()||o&&o.name&&"adcue"===o.name.toLowerCase())||(a?t.ima3.cueState_.usedActiveCues[a]||n.name&&"adcancel"===n.name.toLowerCase()||(0===r?D(t,n,a,r,d):d<=1&&!t.ima3.cueState_.postrollHandled?(t.ima3.cueState_.postrollHandled=!0,t.ima3.oneUnlessContentUpdate_("contentended",(function(){U(t,n,a,r,d)}))):t.ima3.isReady_&&!t.ads.isInAdMode()&&U(t,n,a,r,d)):e.log.error("The cue does not have an ID and cannot be used",n))},F=function(t,n,a,r){t.ima3.settings.useMediaCuePoints||"adCancel"!==n.name||!t.ima3.adsManager||t.ima3.cueState_.usedActiveCues[a]||(t.ima3.cueState_.usedActiveCues[a]=!0,t.ima3.adsManager.stop(),e.log("Cancelling oncue ad at "+r+" seconds"))},H=function(e){return function(){var t=this.activeCues;if(!e.scrubbing()&&t&&t.length){var n=[t[t.length-1]];if(!N(e,this))return void this.removeEventListener("cuechange",e.ima3.cueState_.adCueChangeHandler);e.ima3.cueState_.cueModule.processAdTrack(e,n,V,F)}}},z=function(e,t){var n,a,r=t.cues;if(N(e,t)){if(r&&void 0!==r.length){for(var o=0;o<r.length;o++){var i=e.mediainfo?Math.max(e.duration(),e.mediainfo.duration):e.duration();Math.abs(r[o].startTime-i)<=1?n=r[o]:0===r[o].startTime&&(a=r[o])}if(a||"media-cues"!==t.label){if(a){var d=e.ima3.cueState_.cueModule.getSupportedAdCue(e,a),s=e.ima3.cueState_.cueModule.getCueId(e,a),A=a.startTime,u=Math.abs(A-x(e));D(e,d,s,A,u)}}else e.trigger("nopreroll");n||"media-cues"!==t.label||e.trigger("nopostroll")}t.addEventListener("cuechange",e.ima3.cueState_.adCueChangeHandler)}},G=O={init:function(e,t){t.useMediaCuePoints||e.on("loadedmetadata",(function(){e.trigger("nopreroll"),O.liveCuePointHandler(e,e.ads.cueTextTracks)})),e.trigger("adsready"),e.on("contentchanged",(function(){e.trigger("adsready")}))},liveCuePointHandler:function(t,n){!function(e,t){e.ima3.cueState_={cueModule:t,adCueChangeHandler:H(e),usedActiveCues:{},prerollHandledEarly:!1,prerollPlayed:!1,postrollHandled:!1,postrollPlayed:!1}}(t,n),t.ima3.cueState_.cueModule.setMetadataTrackMode=function(e){e.mode="hidden"},t.ima3.cueState_.cueModule.getCueId=function(e,t){var n=e.ima3.cueState_.cueModule.getSupportedAdCue(e,t);return n?n.id:null},t.ima3.cueState_.cueModule.isSupportedAdCue=function(e,t){return null!==e.ima3.cueState_.cueModule.getSupportedAdCue(e,t)},t.ima3.cueState_.cueModule.getSupportedAdCue=function(t,n){return"oncue"!==t.ima3.settings.requestMode||t.ima3.settings.useMediaCuePoints?null:function(t){var n;if(t&&!t.value||"TXXX"!==t.value.key)return null;try{n=JSON.parse(t.value.data)}catch(t){return e.log.error("ERROR: Parsing JSON. Please confirm that JSON is valid.",t.message),null}if(!n.name)return null;var a=n.name.toLowerCase();return"adcue"!==a&&"adcancel"!==a?null:n}(n)},t.ima3.cueState_.cueModule.processMetadataTracks(t,z)}};function W(e){if("string"==typeof e){var t=e.match(/^([\d]+)\.([\d]+)\.([\d]+)/);if(t)return[Number(t[1]),Number(t[2]),Number(t[3])]}}var Q,Y=W("6.7.0");function X(t){return e.getPlugin?e.getPlugin(t):e.getComponent("Player").prototype[t]}function Z(e){return{width:parseInt(Q.computedStyle(e.el(),"width"),10),height:parseInt(Q.computedStyle(e.el(),"height"),10)}}function J(t){if(+t<0)return e.log.error("duration "+t+" can't be a negative number"),"00:00:00.000";if(+t>=86400)return e.log.error("duration "+t+" can't be over 24h"),"00:00:00.000";var n=1e3*t,a=parseInt(n%1e3,10),r=parseInt(n/1e3%60,10),o=parseInt(n/6e4%60,10),i=parseInt(n/36e5%24,10);return a<10?a="00"+a:a<100&&(a="0"+a),(i=i<10?"0"+i:i)+":"+(o=o<10?"0"+o:o)+":"+(r=r<10?"0"+r:r)+"."+a}function $(e){e.ima3.adsManager&&(e.ima3.adsManager.destroy(),e.ima3.adsManager=null),e.ima3.managerCleanup&&(e.ima3.managerCleanup(),e.ima3.managerCleanup=null)}function K(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)n.hasOwnProperty(a)&&(e[a]=n[a])}return e}var ee=function(e){if(void 0!==e)return"application/javascript"===e.getContentType();throw new Error("Cannot check if the current ad is a VPAID when there is no ad.")},te=function(e){return!(!e||0!==e.getCuePoints().length)},ne=Q={computedStyle:function(e,n){return"function"==typeof getComputedStyle?t.getComputedStyle(e)[n]:e.currentStyle[n]},getPlayerDimensions:Z,secondsToTime:J,destroyAdsManager:$,extend:K,loadScript:function(e,t){var a=n.createElement("script"),r=n.querySelector("head");a.async=!0,a.src=e,a.onload=a.onreadystatechange=function(e,n){(n||!a.readyState||/loaded|complete/.test(a.readyState))&&(a.onload=a.onreadystatechange=null,a.parentNode.removeChild(a),a=null,t(n))},r.insertBefore(a,r.firstChild)},isEconomicsFree:function(e){return"object"==typeof e.mediainfo&&"FREE"===e.mediainfo.economics},isVpaid:ee,isVast:te,isVmap:function(e){return!(!e||0===e.getCuePoints().length)},includesPreroll:function(e){return te(e)||e.getCuePoints().indexOf(0)>=0},includesPostroll:function(e){return e.getCuePoints().indexOf(-1)>=0},usingLiveAdCuepoints:function(e){return"oncue"===e.requestMode&&!e.useMediaCuePoints},usingMediaCuepoints:function(e){return"oncue"===e.requestMode&&e.useMediaCuePoints}},ae=["audioTrackButton","captionsButton","chaptersButton","descriptionsButton","subsCapsButton","subtitlesButton"],re=function(e){return[].concat(e).filter((function(e){return-1===ae.indexOf(e)}))},oe=function(t,n){if(!("adControlBar"in n)){var a={name:"adControlBar"},r=t.getChild("controlBar");r&&r.getChild("volumeMenuButton")?a.volumeMenuButton={vertical:r.getChild("volumeMenuButton").options_.vertical}:r&&r.getChild("volumePanel")&&(a.volumePanel={inline:r.getChild("volumePanel").options_.inline}),n.adControlBar=K({},t.options_.children.controlBar,a)}if(!n.adControlBar.hasOwnProperty("children")){var o=e.getComponent("ControlBar");n.adControlBar.children=re(o.prototype.options_.children)}n.showVpaidControls||t.addClass("vjs-vpaid-controls-disabled"),t.on("ima3-content-pause-requested",(function(e){t.addClass("ima3-ad-loading"),t.trigger("ads-pod-started"),"application/javascript"===e.originalEvent.getAd().getContentType()&&t.addClass("vjs-vpaid-playing")})),t.on("ima3-complete",(function(e){var n=t.$(".vjs-ad-control-bar .vjs-play-progress");n.className+=" vjs-play-progress-resetting",n.style.width="0"})),t.on("ima3-started",(function(e){var n=t.$(".vjs-ad-control-bar .vjs-play-progress");n.className=n.className.replace(" vjs-play-progress-resetting","")}))},ie=function(t,n){var a=new(e.getComponent("ControlBar"))(n,t.ima3.settings.adControlBar);a.addClass("vjs-ad-control-bar"),t.addClass("vjs-ad-controls"),t.addChild(a),t.ima3.adControlBar=a,!e.browser.IS_IOS&&!e.browser.IS_ANDROID||t.tech_.featuresVolumeControl||t.muted()||a.volumeMenuButton&&a.volumeMenuButton.addClass("vjs-hidden")},de=function(e){e.on("ads-ad-started",(function(){e.ads.inAdBreak()&&!e.ads.videoElementRecycled()&&(e.ima3.volume=e.volume(),e.muted()?e.ima3.adPlayer.muted(!0):e.ima3.adPlayer.volume(e.volume()||e.ads.preAdVolume_)),e.ima3.adPlayer.trigger("durationchange")})),e.on(["ads-ad-ended","ads-ad-skipped"],(function(){e.ads.inAdBreak()&&!e.ads.videoElementRecycled()&&(e.volume(e.ima3.adPlayer.volume()),e.ads.preAdVolume_&&(e.ads.preAdVolume_=e.volume()),e.muted(e.ima3.adPlayer.muted()))}))},se=function(n,a){var r=(e.ima3.AdPlayer=e.extend(e.getComponent("Component"),{constructor:function(){var t=[this].concat(Array.prototype.slice.call(arguments));e.getComponent("Component").apply(this,t)},buffered:function(){return[]},language:function(e){return void 0===e?this.options_.contentPlayer.language_:this.options_.contentPlayer.language(e)},languages:function(){return this.options_.contentPlayer.languages()},localize:function(e){return this.options_.contentPlayer.localize(e)},remainingTime:function(){return this.duration()-this.currentTime()},remainingTimeDisplay:function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},exitFullscreen:function(){return this.options_.contentPlayer.exitFullscreen()},reportUserActivity:function(){},requestFullscreen:function(){return this.options_.contentPlayer.requestFullscreen()},el:function(){return this.options_.contentPlayer.el()},audioTracks:function(){},textTracks:function(){},videoTracks:function(){},remoteTextTracks:function(){},addTextTrack:function(){},addRemoteTextTrack:function(){},removeRemoteTextTrack:function(){},scrubbing:function(){},ended:function(){},lastVolume_:function(){var e;return(e=this.options_.contentPlayer).lastVolume_.apply(e,arguments)},handleKeyDown:function(){}}),e.ima3.Html5.adPlayer=function(n,a){var r=a.contentPlayer,o=new e.ima3.AdPlayer(a),i=!0;return o.currentTime=function(){var e=o.duration();if(!e||!r.ima3.adsManager)return 0;var t=r.ima3.adsManager.getRemainingTime();return t<=0||t>e?0:t>0?e-t:void 0},o.duration=function(){var e=r.ima3.currentAd;if(e){var t=e.getDuration();return t>0?t:0}return 0},o.pause=function(){i=!0,r.ima3.adsManager.pause()},o.paused=function(){return i},o.play=function(){i=!1,r.ima3.adsManager.resume(),o.trigger("play")},o.isFullscreen=function(){return r.isFullscreen()},o.requestFullscreen=function(){return r.requestFullscreen()},Object.defineProperty(o,"fsApi_",{get:function(){return r.fsApi_}}),o.volume=function(t){if(r.ima3&&r.ima3.adsManager){var n=r.ima3.adsManager.getVolume();return void 0!==t&&(r.ima3.adsManager.setVolume(t),r.ima3.volume=t||r.ima3.volume,o.trigger("volumechange")),n||r.ima3.volume}e.log.error("Too early to set Volume. IMA3 is not loaded")},o.muted=function(e){var t=r.ima3.adsManager.getVolume();return void 0!==e?0===o.volume(e?0:r.ima3.volume):0===t},r.on("ima3-started",(function(){r.removeClass("vjs-ima3-paused"),o.trigger("play"),i=!1})),r.on("ima3-resumed",(function(){r.removeClass("vjs-ima3-paused"),o.trigger("play"),i=!1})),r.on("ima3-paused",(function(){r.addClass("vjs-ima3-paused"),o.trigger("pause"),i=!0})),function e(){r.ads.isAdPlaying()&&!o.paused()&&o.trigger("timeupdate"),t.setTimeout(e,1e3)}(),o},e.ima3.Html5.adPlayer)(a,{contentPlayer:n});return n.ima3.adPlayer=r,r},Ae="data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAC721kYXQhEAUgpBv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA3pwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcCEQBSCkG//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADengAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAsJtb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAALwABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAB7HRyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAIAAAAAAAAALwAAAAAAAAAAAAAAAQEAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAAC8AAAAAAAEAAAAAAWRtZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAAKxEAAAIAFXEAAAAAAAtaGRscgAAAAAAAAAAc291bgAAAAAAAAAAAAAAAFNvdW5kSGFuZGxlcgAAAAEPbWluZgAAABBzbWhkAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAADTc3RibAAAAGdzdHNkAAAAAAAAAAEAAABXbXA0YQAAAAAAAAABAAAAAAAAAAAAAgAQAAAAAKxEAAAAAAAzZXNkcwAAAAADgICAIgACAASAgIAUQBUAAAAAAfQAAAHz+QWAgIACEhAGgICAAQIAAAAYc3R0cwAAAAAAAAABAAAAAgAABAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAIAAAABAAAAHHN0c3oAAAAAAAAAAAAAAAIAAAFzAAABdAAAABRzdGNvAAAAAAAAAAEAAAAsAAAAYnVkdGEAAABabWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAtaWxzdAAAACWpdG9vAAAAHWRhdGEAAAABAAAAAExhdmY1Ni40MC4xMDE=";function ue(e){for(var t=e.match(/^data:([^;]+);base64,(.+)$/i),n=t[1],a=t[2],r=atob(a),o=r.length,i=Math.ceil(o/1024),d=new Array(i),s=0;s<i;++s){for(var A=1024*s,u=Math.min(A+1024,o),l=new Array(u-A),c=A,m=0;c<u;++m,++c)l[m]=r[c].charCodeAt(0);d[s]=new Uint8Array(l)}return new Blob(d,{type:n})}function le(e){return Object.assign({muted:!1,timeout:250,inline:!1,blob:!1},e)}function ce(e,t){var n=e.muted,a=e.timeout,r=e.inline,o=t(),i=o.element,d=o.source,s=void 0,A=void 0,u=void 0;return i.muted=n,!0===n&&i.setAttribute("muted","muted"),!0===r&&i.setAttribute("playsinline","playsinline"),i.src=d,new Promise((function(e){s=i.play(),A=setTimeout((function(){u(!1,new Error("Timeout "+a+" ms has been reached"))}),a),u=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;clearTimeout(A),e({result:t,error:n})},void 0!==s?s.then((function(){return u(!0)})).catch((function(e){return u(!1,e)})):u(!0)}))}var me={audio:function(e){return ce(e=le(e),(function(){var t=e.blob?URL.createObjectURL(ue(Ae)):"data:audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq";return{element:document.createElement("audio"),source:t}}))},video:function(e){return ce(e=le(e),(function(){var t=e.blob?URL.createObjectURL(ue(Ae)):Ae;return{element:document.createElement("video"),source:t}}))}},pe=function(e,t){return t.reduce((function(t,n){return t.then((function(){if(!e.ima3.canAutoPlayVideo&&!e.ima3.canAutoPlayInlineVideo)return function e(t,n){return me[n.method](n.params).then((function(a){var r=a.result,o=a.error;if(t.ima3[n.prop]=r,o&&"Error"===o.name&&n.params.retryAfterTimeout&&(!t.ima3.canAutoPlayVideo||!t.ima3.canAutoPlayInlineVideo))return n.params.retryAfterTimeout--,e(t,n)}))}(e,n)}))}),Promise.resolve()).then((function(){return Promise.resolve()}))};function ge(n){var a,r=e.browser.IS_IOS,o=e.browser.IS_IPAD,i=e.browser.IS_SAFARI&&e.browser.TOUCH_ENABLED;return a=o||i||r&&n.playsinline()?[{prop:"canAutoPlayMutedVideo",method:"video",params:{retryAfterTimeout:2,timeout:250,muted:!0}}]:r&&n.playsinline()?[{prop:"canAutoPlayMutedInlineVideo",method:"video",params:{retryAfterTimeout:2,timeout:250,muted:!0,inline:!0}}]:[{prop:"canAutoPlayVideo",method:"video",params:{retryAfterTimeout:2,timeout:250,muted:!1}},{prop:"canAutoPlayMutedVideo",method:"video",params:{retryAfterTimeout:2,timeout:250,muted:!0}}],t.Promise?n.autoplay()?n.getAutoplayConditions?n.getAutoplayConditions().then((function(e){e.muted&&n.muted(!0),e.inline&&n.playsinline(!0),e.never||n.play()})):(n.ima3.canAutoPlayTestsResult||(n.ima3.canAutoPlayTestsResult=pe(n,a)),n.ima3.canAutoPlayTestsResult):Promise.resolve():(n.ima3.canAutoPlayVideo=!0,n.ima3.canAutoPlayMutedVideo=!0,{then:function(e){e()}})}var fe,he=function(t){"string"==typeof t.autoplay()&&e.log.warn('Brightcove IMA3: Special string-based autoplay values (such as "'+t.autoplay()+'") are not currently supported with this plugin.'),t.addClass("vjs-ima3-not-playing-yet"),t.ready((function(){ge(t).then((function(){t.autoplay()&&!t.ima3.canAutoPlayVideo&&t.ima3.canAutoPlayMutedVideo&&(t.muted(!0),t.play()),e.browser.IS_IOS&&t.playsinline()&&!1!==t.autoplay()&&t.ima3.canAutoPlayMutedInlineVideo&&(t.muted(!0),t.play())}))})),t.on(["playing"],(function(e){t.removeClass("vjs-ima3-not-playing-yet")})),!t.autoplay()||e.browser.IS_IOS||e.browser.IS_ANDROID||t.addClass("vjs-ima3-autoplay")},ve=fe={_addPlayerDimensions:function(t,n){(0,e.ima3.extend)(n,{linearAdSlotWidth:t.width,linearAdSlotHeight:t.height,nonLinearAdSlotWidth:t.width,nonLinearAdSlotHeight:t.height})},_addVmap:function(e,t,n){e.ima3.isReady_?t.adsResponse=n:e.ima3.oneUnlessContentUpdate_("ima3-ready",(function(){t.adsResponse=n}))},_adsRequest:function(e,n,a){var r=e.ima3.settings.requestMode,o=e.ima3.settings.useMediaCuePoints,i=t.google.ima;if(!i||i&&!i.AdsRequest)throw new Error("An ad request was made before the plugin is ready");var d=new i.AdsRequest;return fe._addPlayerDimensions(ne.getPlayerDimensions(e),d),"oncue"===r&&o&&a?fe._addVmap(e,d,a):d.adTagUrl=n,e.ima3.adsRequest=d,ge(e).then((function(){d.setAdWillPlayMuted(e.muted()),d.setAdWillAutoPlay(e.autoplay()),e.ima3.adsLoader.requestAds(d),e.trigger("ads-request")}))},_handleEconomicsFree:function(e){e.trigger("nopreroll"),e.trigger("nopostroll")},_isRepeatForSourceAllowed:function(e){var t=e.ima3.settings.requestMode;return"onload"!==t&&"onplay"!==t},_isRepeatForSource:function(e){return e.ima3.lastSrc_===e.currentSrc()},_handleMissingAdTagUrl:function(e){e.trigger("adscanceled"),e.trigger("nopreroll"),e.trigger("nopostroll")},_afterServerUrlFunctionCheck:function(e,t,n){var a,r=e.ima3.settings.requestMode;null!=t&&(a=e.ima3.adMacroReplacement(t)),"oncue"===r||a?fe._adsRequest(e,a,n):fe._handleMissingAdTagUrl(e)},_handleServerUrlFunctionResponse:function(e,t){ne.isEconomicsFree(e)?fe._handleEconomicsFree(e):fe._afterServerUrlFunctionCheck(e,t)},_afterPlay:function(e,t,n){var a=e.ima3.settings.useMediaCuePoints;ne.isEconomicsFree(e)?fe._handleEconomicsFree(e):(a||(t=t||e.ima3.settings.serverUrl),a||"function"!=typeof t?fe._afterServerUrlFunctionCheck(e,t,n):t((function(t){fe._handleServerUrlFunctionResponse(e,t)})))},_shouldWaitUntilPlay:function(e){var t=e.ima3.settings.requestMode,n=e.ima3.settings.useMediaCuePoints;return("onplay"===t||"oncue"===t&&n)&&!e.ima3._playSeen&&e.paused()&&!e.ads._pausedOnContentupdate},_waitUntilPlay:function(e,t,n){ne.isEconomicsFree(e)?fe._handleEconomicsFree(e):(e.ima3._requestAdsOnPlay=function(){fe._afterPlay(e,t,n)},e.one("play",e.ima3._requestAdsOnPlay))},requestAds:function(t,n,a){!fe._isRepeatForSource(t)||fe._isRepeatForSourceAllowed(t)?fe._shouldWaitUntilPlay(t)?fe._waitUntilPlay(t,n,a):fe._afterPlay(t,n,a):e.log("Cancelling repeat adsRequest for "+t.currentSrc())}},ye=function(e){e.trigger("nopreroll"),e.trigger("nopostroll")},Se=function(t,n){n.ima3.isReady_?n.mediainfo&&"FREE"===n.mediainfo.economics?e.log("On demand adRequest attempted on video with advertising disabled."):t?(e.log("Clearing any previous VAST ad data and triggering ondemand adrequest."),n.ads.startLinearAdMode(),$(n),ve.requestAds(n,t),n.addClass("ima3-ad-loading")):e.log("On demand adRequest attempted without an adTagUrl!"):e.log.error("Cannot make an ad request when the plugin is not ready. Skipping ad...")},Ce={0:"PREROLL","-1":"POSTROLL"},_e=function(e,t,n){""!==n&&(e.currentAdEventInfo[t]?e.currentAdEventInfo[t].push(n):e.currentAdEventInfo[t]=[n])},Pe=function(e,t){void 0!==e.ima3.currentAd&&(e.ads.ad.id=e.ima3.currentAd.getAdId(),e.ads.ad.duration=e.ima3.currentAd.getDuration(),e.ads.ad.currentTime=e.ima3.adsManager?e.ima3.currentAd.getDuration()-e.ima3.adsManager.getRemainingTime():e.ima3.currentAd.getDuration(),e.ads.ad.timeOffset=e.ima3.currentAd.getAdPodInfo().getTimeOffset(),e.ads.ad.index=e.ima3.currentAd.getAdPodInfo().getAdPosition()-1,e.ads.ad.type=Ce[e.ima3.currentAd.getAdPodInfo().getTimeOffset()]||"MIDROLL",e.ads.pod.id=e.ima3.currentAd.getAdPodInfo().getPodIndex(),e.ads.pod.size=e.ima3.currentAd.getAdPodInfo().getTotalAds(),"ima3-started"===t&&(!function(e,t){if(void 0!==t){var n=e.ima3;n.currentAdEventInfo.adPodId=e.ads.pod.id,n.currentAdEventInfo.adPodLength=e.ads.pod.size,n.currentAdEventInfo.adType=e.ads.adType,_e(n,"adId",e.ads.ad.id),_e(n,"creativeLength",e.ads.ad.duration),_e(n,"creativeIndex",e.ads.ad.index),_e(n,"creativeId",t.getCreativeId()),_e(n,"creativeAdId",t.getCreativeAdId()),_e(n,"creativeFormat",t.getContentType()),_e(n,"creativeUrl",t.getMediaUrl()),_e(n,"surveyUrl",t.getSurveyUrl()),_e(n,"adTitle",t.getTitle()),_e(n,"wrapperCreativeIds",t.getWrapperCreativeIds()),_e(n,"advertiserName",t.getAdvertiserName()),_e(n,"dealId",t.getDealId()),_e(n,"adSystem",t.getAdSystem()),_e(n,"wrapperAdSystems",t.getWrapperAdSystems())}}(e,e.ima3.currentAd),_e(e.ima3,"started",e.ads.ad.index))),"ima3-complete"===t&&_e(e.ima3,"completed",e.ads.ad.index)},Me=function(e,t,n){var a={},r=t||"";if(e.bcinfo&&(a["{player.url}"]=e.bcinfo.scriptUrl),n&&n.metadata&&-1!==t.indexOf("{mediainfo.ad_keys}")){var o=encodeURIComponent(n.metadata);r=t.replace("{mediainfo.ad_keys}",o)}return e.ads.adMacroReplacement(r,!0,a)};function be(e){var t=e.mediainfo,n=e.ima3.settings.serverUrl;if(t&&"AD_SUPPORTED"===t.economics&&t.cuePoints.length>0){for(var a='<vmap:VMAP xmlns:vmap="http://www.iab.net/videosuite/vmap" version="1.0">\n',r=!1,o=0;o<t.cuePoints.length;o++)if("AD"===t.cuePoints[o].type){r=!0,t.cuePoints[o].time<1?a+='<vmap:AdBreak timeOffset="start" breakType="linear" breakId="'+t.cuePoints[o].name+'">\n':t.duration-t.cuePoints[o].time<1?a+='<vmap:AdBreak timeOffset="end" breakType="linear" breakId="'+t.cuePoints[o].name+'">\n':a+='<vmap:AdBreak timeOffset="'+J(t.cuePoints[o].time)+'" breakType="linear" breakId="'+t.cuePoints[o].name+'">\n';var i=Me(e,n,t.cuePoints[o]);a+=' <vmap:AdSource id="'+t.cuePoints[o].id+'" allowMultipleAds="true" followRedirects="true">\n<vmap:AdTagURI templateType="vast3">\n<![CDATA['+i+"]]>\n</vmap:AdTagURI>\n</vmap:AdSource>\n</vmap:AdBreak>\n"}return a+="</vmap:VMAP>",r||(a=null),a}}var Te={"ima3-click":"ads-click","ima3-started":"ads-ad-started","ima3-complete":"ads-ad-ended","ima3-first-quartile":"ads-first-quartile","ima3-midpoint":"ads-midpoint","ima3-third-quartile":"ads-third-quartile","ima3-volume-changed":"ads-volumechange","ima3-paused":"ads-pause","ima3-resumed":"ads-play","ima3-skipped":"ads-ad-skipped","ima3-all-ads-completed":"ads-allpods-completed","ads-request":"ads-request","ads-pod-ended":"ads-pod-ended","ads-pod-started":"ads-pod-started","ads-load":"ads-load"},ke=function(e,t,n,a){var r=function(n){e.trigger({type:a,emitter:t,originalEvent:n}),Pe(e,a);var r=Te[a];if(r){var o={type:r};"ads-ad-started"!==r&&"ads-ad-ended"!==r||(o.indexInBreak=e.ads.ad.index),e.trigger(o)}};return t.addEventListener(n,r,!1),r},we=function(e,t,n){var a={},r=t.ima3._eventMapping.eventTypes;for(var o in void 0===n&&(n=ke),r)a[o]=n(t,e,o,r[o]);return function(){for(var t in a)e.removeEventListener(t,a[t])}},Re=function(e){return"ima3-"+e.toLowerCase().replace(/_/g,"-")},qe=function(e){for(var t=e.textTracks(),n=0;n<t.length;n++)"metadata"===t[n].kind&&"disabled"===t[n].mode&&(t[n].mode="hidden")},Ee=function(n){n.on("fullscreenchange",(function(a){var r=t.google.ima;e.IS_ANY_SAFARI&&qe(n);var o=n.hasClass("vjs-fullscreen");if(n.ima3&&n.ima3.adsManager){var i=o?r.ViewMode.FULLSCREEN:r.ViewMode.NORMAL,d=Z(n);i===r.ViewMode.FULLSCREEN?n.ima3.adsManager.resize(n.el().offsetWidth,n.el().offsetHeight,i):n.ima3.adsManager.resize(d.width,d.height,i),setTimeout(function e(t,n,a,r,o,i){var d=Z(t);return function(){n===a.ViewMode.FULLSCREEN?t.ima3.adsManager.resize(t.el().offsetWidth,t.el().offsetHeight,n):t.ima3.adsManager.resize(d.width,d.height,n),d.width===o&&d.height===i||r>=0&&setTimeout(e(t,n,a,r-1,d.width,d.height),1e3)}}(n,i,r,3,d.width,d.height),1e3)}})),n.on("playerresize",(function(){if(n.ima3.adsManager){var e=Z(n);n.ima3.adsManager.resize(e.width,e.height,t.google.ima.ViewMode.NORMAL)}}))},Ie=function(e,t){var n=e.AdError.ErrorCode;for(var a in n)if(n.hasOwnProperty(a)&&!a.match("COMPANION|NONLINEAR|OVERLAY")&&t.getErrorCode()===n[a]&&"adLoadError"===t.getType())return!0;return!1},Be=function(t){var n=t.ima3.adsManager;ne.isVast(n)?(ne.destroyAdsManager(t),t.trigger("ad-hard-timeout"),e.log("ima3-hard-timeout")):ne.isVmap(n)&&ne.includesPreroll(n)&&(t.ima3.adsManager.discardAdBreak(),t.trigger("ad-hard-timeout"),e.log("ima3-hard-timeout"))},Le=function(e){e.ima3.adDisplayContainer&&!e.ima3.adDisplayContainer.initialized&&(e.ima3.adDisplayContainer.initialize(),e.ima3.adDisplayContainer.initialized=!0)},je=function(n){var a=t.google.ima,r=ne.getPlayerDimensions(n);try{n.muted()&&n.ima3.adsManager.setVolume(0),Le(n),n.trigger("ads-load"),n.ima3.adsManager.init(r.width,r.height,a.ViewMode.NORMAL),n.ima3.adsManager.start()}catch(t){e.log.warn("Error starting ads manager",t),n.trigger("adserror")}},Oe=function(e){e.ima3.adsManager.discardAdBreak(),e.ima3.adsManager.skip(),e.ima3.managerCleanup=null,e.ads.inAdBreak()&&e.ads.endLinearAdMode()},Ne=function(t,n){if(n.ima3SdkSettings)for(var a in n.ima3SdkSettings){var r="set"+a.charAt(0).toUpperCase()+a.slice(1);"function"==typeof t.settings[r]?t.settings[r](n.ima3SdkSettings[a]):e.log.warn('Invalid ima3SdkSetting: "'+a+'"')}},Ue=function(n,a,r){var o=t.google.ima,i={};!function(e){e._eventMapping={},e.settings.eventMap=Te;for(var n=t.google.ima,a={},r=["AdErrorEvent","AdEvent","AdsManagerLoadedEvent"],o=r.length;o--;)if(n[r[o]]&&n[r[o]].Type){var i=n[r[o]].Type;for(var d in i)i.hasOwnProperty(d)&&(a[i[d]]=Re(d))}e._eventMapping.eventTypes=a}(n.ima3),Ne(o,a);var d=se(n,r);if(ie(n,d),a.vpaidMode){if("number"!=typeof o.ImaSdkSettings.VpaidMode[a.vpaidMode])throw new Error('Invalid VPAID Mode: "'+a.vpaidMode+'"');o.settings.setVpaidMode(o.ImaSdkSettings.VpaidMode[a.vpaidMode])}var s=n.el().querySelector(".vjs-tech");n.ima3.adDisplayContainer=new o.AdDisplayContainer(r,s,a.clickTrackingElement),n.ima3.adDisplayContainer.initialized=!1;var A="click";(e.browser.IS_IOS||e.browser.IS_ANDROID)&&(A="touchend"),n.one(A,(function(){Le(n)})),n.ima3.adsLoader=new o.AdsLoader(n.ima3.adDisplayContainer);var u=n.ima3.adsLoader.getSettings();u.setPlayerVersion(n.ima3.version),u.setPlayerType("brightcove/player-html5"),n.ima3.loaderCleanup=we(n.ima3.adsLoader,n);var l=n.currentSrc();ne.usingMediaCuepoints(a)&&function(t,n,a){t.ima3._loadstartSeen&&t.ima3.settings.serverUrl&&t.mediainfo?a.vmap=be(t):t.ima3.oneUnlessContentUpdate_("loadstart",(function(){setTimeout((function(){t.ima3.settings.serverUrl?a.vmap=be(t):e.log.error("ima3 serverUrl isnt provided")}),0)}))}(n,0,i),function(e,t,n){if("ondemand"!==t.requestMode&&!ne.usingLiveAdCuepoints(t)){var a=function(){e.mediainfo&&"FREE"===e.mediainfo.economics?(e.trigger("adscanceled"),e.trigger("nopreroll"),e.trigger("nopostroll")):ve.requestAds(e,null,n.vmap)};e.ima3._loadstartSeen?a():e.one("loadstart",(function(){setTimeout((function(){a()}),0)}))}}(n,a,i),n.ima3.currentSrc_=n.currentSrc(),n.on("dispose",(function(){ne.destroyAdsManager(n),e._ima3sawDispose=!0})),n.on("contentchanged",(function(){!function(e,t,n,a){setTimeout((function(){if(n=e.currentSrc(),ne.destroyAdsManager(e),e.ima3._checkedForAdManagerStart=!1,e.ima3.lastSrc_=e.ima3.currentSrc_,e.ima3.currentSrc_=e.currentSrc(),ne.isEconomicsFree(e))return e.trigger("adscanceled"),e.trigger("nopreroll"),void e.trigger("nopostroll");"ondemand"!==t.requestMode?n&&""!==n&&"ondemand"!==t.requestMode&&!ne.usingLiveAdCuepoints(t)&&ve.requestAds(e,null,a):ye(e)}),0)}(n,a,l,i.vmap)}));var c=function(){!function(t){t.ima3&&t.ima3.adsManager&&t.ima3.adsManager.skip&&t.ima3.adsManager.skip(),ne.destroyAdsManager(t),t.trigger("ad-hard-timeout"),e.log("ima3-hard-timeout")}(n)};n.on("contentended",(function(){n.one("adtimeout",c),n.ima3.adsLoader.contentComplete()})),n.on(["contentupdate","dispose"],(function(){n.off("adtimeout",c),n.ima3.adsLoader.contentComplete()})),n.on(["contentupdate","adend","ima3-ready"],(function(){n.ads.ad={},n.ads.pod={}})),n.ima3.el=r},De=function(e){var t=e.ima3.adsManager.getCuePoints(),n=t&&t.length>0,a=!(!e.ima3.adsRequest||!e.ima3.adsRequest.adsResponse);return ne.usingMediaCuepoints(e.ima3.settings)&&n&&!a},xe=function(t,n){"ondemand"===n.requestMode||ne.usingLiveAdCuepoints(n)||t.ads.startLinearAdMode(),e._ima3sawDispose&&!e._ima3adAfterDispose&&(t.trigger({type:"usage",name:"ima3-ad-after-dispose"}),e._ima3adAfterDispose=!0)},Ve=function(e){e.ads.inAdBreak()?(e.ads.endLinearAdMode(),e.removeClass("ima3-ad-loading"),e.removeClass("vjs-vpaid-playing"),e.trigger("ads-pod-ended")):e.ads.skipLinearAdMode()},Fe=function(e){var t="Non-fatal error occurred";if(e){var n=e.getErrorCode(),a=e.getMessage();n&&(t+=": AdError "+n),a&&(t+=": "+a)}return t},He=function(e){e.on("adstart",(function(t){e.ads.shouldPlayContentBehindAd(e)||e.pause(),e.hasStarted(!0),e.ima3.currentAdEventInfo={},"oncue"!==e.ima3.settings.requestmode&&e.duration()===1/0&&e.trigger({type:"usage",name:"ima3-live-preroll"})})),e.on("adend",(function(){e.duration()===1/0&&e.trigger("playing")})),e.on("adplay",(function(){e.ads.shouldTakeSnapshots()&&(e.tech_.src()!==e.ads.snapshot.src||e.currentSrc()!==e.ads.snapshot.currentSrc||setTimeout((function(){e.pause()}),0))}))},ze=function(a,r){var o=n.createElement("div");o.className="vjs-ima3-ad-container",a.ima3.insertAdContainer(o),a.ima3.adrequest=function(e){Se(e||r.serverUrl,a)},a.on("ima3-content-pause-requested",(function(e){xe(a,r)})),a.on("ima3-content-resume-requested",(function(e){Ve(a)})),Ee(a),a.on("ima3-started",(function(t){a.removeClass("ima3-ad-loading"),e.log("ima3-started"),a.ima3.currentAd=t.originalEvent.getAd()})),a.on("ima3-log",(function(t){var n=t.originalEvent.getAdData().adError;e.log("ima3-log:",Fe(n))})),a.on("ima3-ad-error",(function(n){var r,o={};n.originalEvent&&(r=(o=n.originalEvent.getError()).getErrorCode(),e.log("ima3-ad-error",o.toString()),(Ie(t.google.ima,o)&&"onload"===a.ima3.settings.requestMode||"onplay"===a.ima3.settings.requestMode)&&a.trigger("nopostroll")),a.removeClass("ima3-ad-loading"),a.trigger({type:"adserror",errorCode:r})})),r.hardTimeouts&&a.on("adtimeout",(function(){if(a.ima3.adsManager)Be(a);else{var e=function(){Be(a)};a.one("ima3-ads-manager-loaded",e),a.one(["adstart","contentupdate","dispose"],(function(t){a.off("ima3-ads-manager-loaded",e)}))}})),a.on("ima3-loaded",(function(e){var t=e.originalEvent.getAd();a.trigger("ads-loading"),a.removeClass("ima3-ad-loading"),t&&!t.isLinear()&&(a.addClass("vjs-ima3-overlay"),a.ads.startLinearAdMode(),a.ads.endLinearAdMode())})),a.on("ima3-complete",(function(t){var n=t.originalEvent.getAd();e.log("ima3-complete"),delete a.ima3.currentAd,n&&(n.isLinear()?a.addClass("ima3-ad-loading"):a.removeClass("vjs-ima3-overlay"))})),a.on(["readyforpreroll","playing"],(function(){a.ima3._checkedForAdManagerStart||(a.ima3._checkedForAdManagerStart=!0,!a.ima3.adsManager||ne.usingLiveAdCuepoints(r)||"ondemand"===r.requestMode||ne.isEconomicsFree(a)||je(a))})),a.on("adserror",(function(){ne.destroyAdsManager(a)})),a.on("adscanceled",(function(){ne.destroyAdsManager(a)})),a.on("ima3-ads-manager-loaded",(function(t){!function(t,n){t.ima3.managerCleanup&&ne.destroyAdsManager(t);var a={currentTime:t.currentTime(),duration:t.duration()};t.on("timeupdate",(function(){a.currentTime=t.currentTime()}));var r=n.originalEvent.getAdsManager(a,t.ima3.adsRenderingSettings_);t.ima3.adsManager=r,t.trigger("ads-response-received");var o=t.ima3.settings;if(De(t))return Oe(t),void e.log.error("Cancelling VMAP ad because thead server cannot return a vmap when using cuepoints");t.ima3.managerCleanup=we(r,t),"ondemand"===o.requestMode||"oncue"===o.requestMode?je(t):t.trigger("adsready"),"oncue"!==o.requestMode&&(ne.includesPreroll(r)||t.trigger("nopreroll"),ne.includesPostroll(r)||t.trigger("nopostroll"))}(a,t)})),e.use&&!e._imaMiddlewareSetup&&(e.log("Setting up IMA middleware"),e.use("*",(function(e){return{setSource:function(t,n){if(e.hasPlugin("ima3")){if(e&&e.ads&&"function"==typeof e.ads.inAdBreak&&e.ads.inAdBreak()){e.ima3.adsManager.discardAdBreak(),e.ads.disableNextSnapshotRestore=!0,e.ads.endLinearAdMode(),e.trigger("contentresumed");var a=e.play();a&&a.catch&&a.catch((function(){}))}n(null,t)}else n(new Error("IMA3 is not being used currently"),t)}}})),e._imaMiddlewareSetup=!0),t.google&&t.google.ima?(Ue(a,r,o),a.trigger({type:"ima3-ready",imaSdk:"ondemand"===r.requestMode?t.google.ima:null})):ne.loadScript(r.sdkurl,(function(e){Ue(a,r,o),e?a.trigger({type:"adserror",info:e}):a.trigger({type:"ima3-ready",imaSdk:"ondemand"===r.requestMode?t.google.ima:null})}))},Ge={sdkurl:(/^(file|data):/.test(t.location.protocol)?"http:":"")+"//imasdk.googleapis.com/js/sdkloader/ima3.js",adTechOrder:["html5"],serverUrl:("file:"===t.location.protocol?"http:":"")+"//pubads.g.doubleclick.net/gampad/ads?sz=400x300&iu=%2F6062%2Fiab_vast_samples&ciu_szs=300x250%2C728x90&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=[referrer_url]&correlator=[timestamp]&cust_params=iab_vast_samples%3Dlinear",timeout:4e3,requestMode:"onload",hardTimeouts:!0,showVpaidControls:!1};e.ima3={extend:K};var We=function(t){var n=this,a=function(t,n){var a=K({},Ge,n||{});if(t.ima3.defaults=Ge,n&&n.useMediaCuePoints&&"oncue"!==n.requestMode)throw new Error('useMediaCuePoints must be used with requestMode "oncue" rather than the currently set '+n.requestMode);return"onplay"===a.requestMode&&t.autoplay()&&(a.requestMode="onload"),a.prerollTimeout&&(e.log.warn("The prerollTimeout option is deprecated and will be removed, please use the timeout option. The prerollTimeout will be set to the value of the timeout option."),a.prerollTimeout=void 0),a.postrollTimeout&&(e.log.warn("The postrollTimeout option is deprecated and will be removed, please use the timeout option. The postrollTimeout will be set to the value of the timeout option."),a.postrollTimeout=void 0),a.timeout&&(a.prerollTimeout=a.postrollTimeout=a.timeout),a.contribAdsPrerollTimeout&&(a.prerollTimeout=a.contribAdsPrerollTimeout),a.contribAdsPostrollTimeout&&(a.postrollTimeout=a.contribAdsPostrollTimeout),a.debug=a.debugContribAds,a.liveCuePoints="oncue"===a.requestMode,a}(this,t);t&&t.hasOwnProperty("asyncAutoplaySupport")&&e.log.warn("Brightcove IMA3: The asyncAutoplaySupport option no longer has any effect. We recommend removing it."),he(this),oe(this,a,K),de(this),this.on(["dispose","contentchanged"],(function(){var e;(e=n).ima3._loadstartSeen=!1,e.ima3._playSeen=!1,void 0!==e.ima3._requestAdsOnPlay&&e.off("play",e.ima3._requestAdsOnPlay)})),this.on("loadstart",(function(){n.ima3._loadstartSeen=!0})),this.on("play",(function(){n.ima3._playSeen=!0})),this.ads(a),this.ads.ad={},this.ads.pod={id:void 0,size:void 0},this.contribAds6Shim(e.mergeOptions({},a.contribAds6Shim||{})),"oncue"===a.requestMode?G.init(this,a):"ondemand"===a.requestMode&&ye(this),this.ima3=function(e,t){var n=e.el().querySelector(".vjs-tech"),a={readyQueue_:[],isReady_:!1,player:e,tech:n,adTech:"html5",settings:t,ready:function(t){return t&&(e.ima3.isReady_?t.call(e):(void 0===e.ima3.readyQueue_&&(e.ima3.readyQueue_=[]),e.ima3.readyQueue_.push(t))),e.ima3},adMacroReplacement:function(t){return Me(e,t)},insertAdContainer:function(t){!function(e,t){var n=e.el().querySelector(".vjs-big-play-button");e.el().insertBefore(t,n)}(e,t)},currentAdEventInfo:{},addToCurrentAdEventInfo:function(t,n){_e(e,t,n)},setAdsRenderingSettings:function(t){!function(e,t){e.ima3.adsRenderingSettings_=t,e.ima3.adsManager&&e.ima3.adsManager.updateAdsRenderingSettings(t)}(e,t)},oneHandlers_:[],oneUnlessContentUpdate_:function(t,n){!function(e,t,n){e.ima3.oneHandlers_.push({type:t,handler:n}),e.one(t,n)}(e,t,n)},isVpaid:function(){return ee(e.ima3.currentAd)},version:"3.6.0",VERSION:"3.6.0"};return e.on("contentupdate",(function(){for(var t=e.ima3.oneHandlers_,n=0;n<t.length;n++){var a=t[n];e.off(a.type,a.handler)}e.ima3.oneHandlers_=[]})),e.on("ima3-ready",(function(){e.ima3.isReady_=!0;for(var t=0;t<e.ima3.readyQueue_.length;t++)e.ima3.readyQueue_[t].call(e);e.ima3.readyQueue_=[]})),a}(this,a),He(this),this.ready((function(){var t=e.getTech("Html5");if(!t||!t.isSupported())throw new Error("Html5 is not available on this platform.");e.ima3.Html5=ze,ze(n,a),n.addClass("vjs-ima3-html5")}),!0)};We.version="3.6.0",We.VERSION="3.6.0",function(t){if(X("ima3"))return!1;var n=X("ads");(function(e,t){var n=W(e),a=t?W(t):Y;return!(!a||!n)&&(n[0]===a[0]&&(!(n[1]<a[1])&&(n[1]>a[1]||n[2]>=a[2])))})(n.VERSION)||e.log.error('The IMA plugin depends on contrib-ads version "'+Y+'", but it saw version "'+n.VERSION+'". This is not a compatible configuration. The IMA plugin will attempt to continue initializing, but this problem should be addressed. If you are using ad failover, please select compatible versions of the SSAI and IMA plugins.'),(e.registerPlugin||e.plugin)("ima3",t)}(We)}));
